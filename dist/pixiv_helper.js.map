{"version":3,"sources":["/pixiv_helper.coffee","/util.js","/menu.coffee","events","/modal.js"],"names":["Deferer","Downloader","EventEmitter","Extracter","Gifcreater","GifFrames","ImageCreater","lib","main","Menu","Modal","Util","require","jQuery","JSZip","GIF","GIF_worker_URL","saveAs","blobs","console","file","imgURL","imgElement","document","delay","gifFrames","size","index","frame","p","blob","FileReader","arrBuffer","files","temp","fileName","MIME","arrayBuffer_file","Blob","url","XMLHttpRequest","e","global","$","util","downloader","extracter","imageCreater","gifCreater","getTitle","downloadPicture","title","Error","showPic","showGif","useDownload","delays","imageSize","img","Math","GM_registerMenuCommand","data","alert","unsafeWindow","mimeTypes","last","arr","l","length","getMIME","name","getFileExtension","split","getUrl","URL","createObjectURL","module","exports","menu","menuCss","menuHTML","process","isArray","Array","xs","Object","prototype","toString","call","defaultMaxListeners","setMaxListeners","n","_events","maxListeners","emit","type","error","arguments","handler","args","slice","apply","listeners","i","addListener","listener","warned","m","undefined","trace","push","on","once","self","g","removeListener","list","indexOf","splice","removeAllListeners","loadPlugin","defaultOption","stat","off","el","find","slideUp","fadeOut","hide","fadeIn","slideDown","fn","modal","option","extend","_modal","is","target","addClass","modal_css","modalContent","join","hook","append","html","show","clear","remove","text"],"mappings":"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","sourceRoot":"..\\src","sourcesContent":["{EventEmitter} = require 'events'\nModal = require 'modal.js'\nMenu = require 'menu.coffee'\nUtil = require 'util.js'\n\nlib = \n  $ : jQuery\n  JSZip : JSZip\n  GIF : GIF\n  GIF_worker_URL : GIF_worker_URL\n  saveAs : saveAs\n\nclass Deferer extends EventEmitter\n  constructor: ->\n    @all = 0\n    @counted = 0\n  add: ->\n    @all++\n  count: ->\n    @counted++\n    @emit 'progress', \n      all : @all\n      fired : @counted\n    if @counted is @all\n      @emit 'done'\n###\n  blobs =\n    blob : blob1,\n    blob : blob2\n###\nclass ImageCreater extends EventEmitter\n  constructor : (@Deferer = Deferer, @$ = lib.$) ->\n    @locked = false\n  create : (blobs) ->\n    if @locked is true\n      console.log 'incorrect invoke'\n      return false\n    @locked = true\n    console.log 'image create start'\n    @deferer = new @Deferer\n    for file in blobs\n      imgURL = Util.getUrl(file.blob)\n      imgElement =  document.createElement \"img\"\n      imgElement.src = imgURL\n      file.image = imgElement\n      @deferer.add()\n      (@$ imgElement).on 'load', =>\n        @deferer.count()\n        return true\n      \n    @deferer.on 'done', =>\n      @emit 'done', blobs\n      @deferer.removeAllListeners 'done'\n      @deferer = null\n      @removeAllListeners 'done'\n      @locked = false\n      return true\n    return true\nclass GifFrames\n  constructor : (@frames = []) ->\n  add : (imgElement, delay) ->\n    @frames.push\n      image : imgElement\n      delay : delay\n    return true\n\n###\n  gifFrames =\n    image : image1\n    delay : delay1,\n    image : image2\n    delay : delay2,\n###\nclass Gifcreater extends EventEmitter\n  constructor: (@Gif = lib.GIF, @Gif_worker_path = lib.GIF_worker_URL) ->\n    @locked = false \n    @cachedFrames = []\n    @cachedGif = []\n  render: (gifFrames, size) ->\n    if @locked is true\n      console.log 'incorrect invoke'\n      return false\n      \n    index = @cachedFrames.indexOf gifFrames\n    if index >= 0\n      @emit 'finished', @cachedGif[index]\n      @removeAllListeners 'finished'\n      return true\n    \n    @locked = true\n    console.log 'Gif create start'\n    @gif = new @Gif\n      workers : 2\n      quality : 10\n      workerScript : @Gif_worker_path\n      width : size[0]\n      height : size[1]\n    for frame in gifFrames\n      @gif.addFrame frame.image,\n        delay: frame.delay\n    @gif.on 'progress', (p)=>\n      @emit 'progress', p\n    @gif.on 'finished', (blob)=>\n      @emit 'finished', blob\n      # prevent memory leak\n      try @gif.removeAllListeners 'finished'\n      try @gif.removeAllListeners 'progress'\n      try @removeAllListeners 'finished'\n      try @gremoveAllListeners 'progress'\n      @cachedFrames.push gifFrames\n      @cachedGif.push blob\n      @gif = null\n      @locked = false\n    @gif.render()\n    return true\n\nclass Extracter extends EventEmitter\n  constructor: (@JSZip = lib.JSZip)->\n    @locked = false\n    @zippedFiles = []\n    @unzippedFiles = []\n  extract: (@blob)->\n    if @locked is true\n      console.log 'incorrect invoke'\n      return false\n    \n    console.log 'extract start'\n    index = @zippedFiles.indexOf @blob\n    if index >= 0\n      console.log \"emit #{@emit 'done', @unzippedFiles[index]}\"\n      @removeAllListeners 'done'\n      return true\n    \n    @locked = true\n    @fileReader = new FileReader\n    @fileReader.onload = ()=>\n      @_onArrayBufferLoaded @fileReader.result\n    @fileReader.readAsArrayBuffer @blob\n    \n  _onArrayBufferLoaded: (arrBuffer)->\n    @zip = new @JSZip arrBuffer\n    files = @zip.file /\\d+.(?:jpg|png|gif)/i\n    temp = []\n    for file in files\n      if file.dir\n        break\n      fileName = file.name\n      MIME = Util.getMIME fileName\n      arrayBuffer_file = file.asArrayBuffer()\n      blob = new Blob [arrayBuffer_file],\n        type : MIME\n      temp.push\n        blob : blob\n        fileName : fileName\n        mime : MIME\n        \n    @zippedFiles.push @blob\n    @unzippedFiles.push temp\n    \n    console.log \"emit #{@emit 'done', temp}\"\n    \n    @blob = null\n    @removeAllListeners 'done'\n    @zip = null\n    @fileReader = null\n    @locked = false\n    return true\n\nclass Downloader extends EventEmitter\n  constructor: ()->\n    @_cachedURL = []\n    @_cache = {}\n    @locked = false\n  download: (url)->\n    if @locked\n      console.log 'incorrect invoke'\n      return false\n    \n    if url in @_cachedURL\n      @emit 'success', @_cache[url]\n      @removeAllListeners 'success'\n      return true\n    \n    @locked = true\n    \n    console.log 'download start'\n    @req = new XMLHttpRequest()\n    @req.open \"GET\", url, true\n    @req.responseType = \"blob\"\n    @req.onload = (e)=>\n      blob = @req.response\n      if blob?\n        @_cachedURL.push url\n        @_cache[url] = blob\n        @emit 'success', blob\n        @removeAllListeners 'success'\n      else\n        @emit 'fail', url\n      @locked = false\n      return true\n    @req.send null\n    return true\n\nmain = (global, $, util, saveAs)->\n  Modal.hook $\n  Menu.hook $\n  downloader = new Downloader\n  extracter = new Extracter\n  imageCreater = new ImageCreater\n  gifCreater = new Gifcreater\n  getTitle = ()->\n    return global.pixiv.context.illustTitle\n  downloadPicture = (size)->\n    title = getTitle()\n    switch size\n      when 'small'\n        url = global.pixiv.context.ugokuIllustData.src\n      when 'full'\n        url = global.pixiv.context.ugokuIllustFullscreenData.src\n      else\n        throw new Error 'unknown size'\n    downloader.on 'success', (blob)->\n      console.log blob\n      saveAs blob, \"#{title}.zip\"\n    console.log downloader.download url\n  \n  showPic = (size)->\n    title = getTitle()\n    switch size\n      when 'small'\n        url = global.pixiv.context.ugokuIllustData.src\n      when 'full'\n        url = global.pixiv.context.ugokuIllustFullscreenData.src\n      else\n        throw new Error 'unknown size'\n    downloader.on 'success', (blob)->\n      Modal.clear()\n      Modal.show()\n      extracter.on 'done', (files)->\n        imageCreater.on 'done', (files)->\n          Modal.clear()\n          for file in files\n            Modal.modalContent.append ($ '<p></p>').text file.fileName\n            Modal.modalContent.append file.image\n          return true\n        imageCreater.create files\n        return true\n      extracter.extract blob\n      return true\n    console.log downloader.download url\n    return true\n    \n  showGif = (size, useDownload)->\n    title = getTitle()\n    delays = global.pixiv.context.ugokuIllustData.frames.slice 0\n    switch size\n      when 'small'\n        url = global.pixiv.context.ugokuIllustData.src\n        imageSize = global.pixiv.context.ugokuIllustData.size.slice 0\n      when 'full'\n        url = global.pixiv.context.ugokuIllustFullscreenData.src\n        imageSize = global.pixiv.context.illustSize.slice 0\n      else\n        throw new Error 'unknown size'\n    downloader.on 'success', (blob)->\n      if not useDownload\n        Modal.clear()\n        Modal.show()\n      extracter.on 'done', (files)->\n        console.log 'extract done'\n        imageCreater.on 'done', (files)->\n          imageSize = [\n            files[0].image.clientWidth || files[0].image.width,\n            files[0].image.clientHeight || files[0].image.height\n          ];\n          Modal.clear()\n          for file in files\n            for delay in delays\n              if file.fileName is delay.file\n                file.delay = delay.delay\n                break\n          console.log files\n          console.log delays\n          if not useDownload\n            gifCreater.on 'finished' , (blob)->\n              Modal.clear()\n              url = Util.getUrl blob\n              img = document.createElement \"img\"\n              img.src = url\n              Modal.modalContent.append img\n              return true\n            gifCreater.on 'progress' , (p)->\n              Modal.modalContent.html \"progressing<br>#{Math.floor (p * 100)}%\"\n              return true\n          else\n            gifCreater.on 'finished' , (blob)->\n              saveAs blob, \"#{title}.gif\"\n              return true\n          gifCreater.render files, imageSize\n          return true\n        imageCreater.create files\n        return true\n      console.log extracter\n      extracter.extract blob\n      return true\n    console.log downloader.download url\n    return true\n    \n  if global.pixiv.context.ugokuIllustData\n    GM_registerMenuCommand '下載動圖', ->\n      Menu.show()\n  \n  ###\n    GM_registerMenuCommand '下載zip檔案!(縮圖)', ->\n      downloadPicture 'small'\n    GM_registerMenuCommand '檢視影格!(縮圖)', ->\n      showPic 'small'\n    GM_registerMenuCommand '檢視GIF!(縮圖)', ->\n      showGif 'small'\n    if global.pixiv.context.ugokuIllustFullscreenData\n      GM_registerMenuCommand '下載zip檔案!(全圖)', ->\n        downloadPicture 'full'\n      GM_registerMenuCommand '檢視影格!(全圖)', ->\n        showPic 'full'\n      GM_registerMenuCommand '檢視GIF!(全圖)', ->\n        showGif 'full'\n  ###\n  \n  Menu.on 'run', (data)->\n    #alert JSON.stringify data\n    switch data.size\n      when 'mini'\n        switch data.type\n          when 'gif'\n            switch data.action\n              when 'download'\n                showGif 'small', true\n              when 'view'\n                showGif 'small'\n          when 'frame'\n            switch data.action\n              when 'download'\n                downloadPicture 'small'\n              when 'view'\n                showPic 'small'\n      when 'full'\n        if not global.pixiv.context.ugokuIllustFullscreenData\n          alert '未登入是無法下載全圖的歐'\n          return true\n        switch data.type\n          when 'gif'\n            switch data.action\n              when 'download'\n                showGif 'full', true\n              when 'view'\n                showGif 'full'\n          when 'frame'\n            switch data.action\n              when 'download'\n                downloadPicture 'full'\n              when 'view'\n                showPic 'full'\n  #console.log Menu.show()\n  #console.log Menu\nconsole.log lib\nmain unsafeWindow, lib.$, Util, lib.saveAs","\r\nvar mimeTypes =\r\n    {\r\n        'a' : 'application/octet-stream',\r\n        'ai' : 'application/postscript',\r\n        'aif' : 'audio/x-aiff',\r\n        'aifc' : 'audio/x-aiff',\r\n        'aiff' : 'audio/x-aiff',\r\n        'au' : 'audio/basic',\r\n        'avi' : 'video/x-msvideo',\r\n        'bat' : 'text/plain',\r\n        'bin' : 'application/octet-stream',\r\n        'bmp' : 'image/x-ms-bmp',\r\n        'c' : 'text/plain',\r\n        'cdf' : 'application/x-cdf',\r\n        'csh' : 'application/x-csh',\r\n        'css' : 'text/css',\r\n        'dll' : 'application/octet-stream',\r\n        'doc' : 'application/msword',\r\n        'dot' : 'application/msword',\r\n        'dvi' : 'application/x-dvi',\r\n        'eml' : 'message/rfc822',\r\n        'eps' : 'application/postscript',\r\n        'etx' : 'text/x-setext',\r\n        'exe' : 'application/octet-stream',\r\n        'gif' : 'image/gif',\r\n        'gtar' : 'application/x-gtar',\r\n        'h' : 'text/plain',\r\n        'hdf' : 'application/x-hdf',\r\n        'htm' : 'text/html',\r\n        'html' : 'text/html',\r\n        'jpe' : 'image/jpeg',\r\n        'jpeg' : 'image/jpeg',\r\n        'jpg' : 'image/jpeg',\r\n        'js' : 'application/x-javascript',\r\n        'ksh' : 'text/plain',\r\n        'latex' : 'application/x-latex',\r\n        'm1v' : 'video/mpeg',\r\n        'man' : 'application/x-troff-man',\r\n        'me' : 'application/x-troff-me',\r\n        'mht' : 'message/rfc822',\r\n        'mhtml' : 'message/rfc822',\r\n        'mif' : 'application/x-mif',\r\n        'mov' : 'video/quicktime',\r\n        'movie' : 'video/x-sgi-movie',\r\n        'mp2' : 'audio/mpeg',\r\n        'mp3' : 'audio/mpeg',\r\n        'mp4' : 'video/mp4',\r\n        'mpa' : 'video/mpeg',\r\n        'mpe' : 'video/mpeg',\r\n        'mpeg' : 'video/mpeg',\r\n        'mpg' : 'video/mpeg',\r\n        'ms' : 'application/x-troff-ms',\r\n        'nc' : 'application/x-netcdf',\r\n        'nws' : 'message/rfc822',\r\n        'o' : 'application/octet-stream',\r\n        'obj' : 'application/octet-stream',\r\n        'oda' : 'application/oda',\r\n        'pbm' : 'image/x-portable-bitmap',\r\n        'pdf' : 'application/pdf',\r\n        'pfx' : 'application/x-pkcs12',\r\n        'pgm' : 'image/x-portable-graymap',\r\n        'png' : 'image/png',\r\n        'pnm' : 'image/x-portable-anymap',\r\n        'pot' : 'application/vnd.ms-powerpoint',\r\n        'ppa' : 'application/vnd.ms-powerpoint',\r\n        'ppm' : 'image/x-portable-pixmap',\r\n        'pps' : 'application/vnd.ms-powerpoint',\r\n        'ppt' : 'application/vnd.ms-powerpoint',\r\n        'pptx' : 'application/vnd.ms-powerpoint',\r\n        'ps' : 'application/postscript',\r\n        'pwz' : 'application/vnd.ms-powerpoint',\r\n        'py' : 'text/x-python',\r\n        'pyc' : 'application/x-python-code',\r\n        'pyo' : 'application/x-python-code',\r\n        'qt' : 'video/quicktime',\r\n        'ra' : 'audio/x-pn-realaudio',\r\n        'ram' : 'application/x-pn-realaudio',\r\n        'ras' : 'image/x-cmu-raster',\r\n        'rdf' : 'application/xml',\r\n        'rgb' : 'image/x-rgb',\r\n        'roff' : 'application/x-troff',\r\n        'rtx' : 'text/richtext',\r\n        'sgm' : 'text/x-sgml',\r\n        'sgml' : 'text/x-sgml',\r\n        'sh' : 'application/x-sh',\r\n        'shar' : 'application/x-shar',\r\n        'snd' : 'audio/basic',\r\n        'so' : 'application/octet-stream',\r\n        'src' : 'application/x-wais-source',\r\n        'swf' : 'application/x-shockwave-flash',\r\n        't' : 'application/x-troff',\r\n        'tar' : 'application/x-tar',\r\n        'tcl' : 'application/x-tcl',\r\n        'tex' : 'application/x-tex',\r\n        'texi' : 'application/x-texinfo',\r\n        'texinfo': 'application/x-texinfo',\r\n        'tif' : 'image/tiff',\r\n        'tiff' : 'image/tiff',\r\n        'tr' : 'application/x-troff',\r\n        'tsv' : 'text/tab-separated-values',\r\n        'txt' : 'text/plain',\r\n        'ustar' : 'application/x-ustar',\r\n        'vcf' : 'text/x-vcard',\r\n        'wav' : 'audio/x-wav',\r\n        'wiz' : 'application/msword',\r\n        'wsdl' : 'application/xml',\r\n        'xbm' : 'image/x-xbitmap',\r\n        'xlb' : 'application/vnd.ms-excel',\r\n        'xls' : 'application/vnd.ms-excel',\r\n        'xlsx' : 'application/vnd.ms-excel',\r\n        'xml' : 'text/xml',\r\n        'xpdl' : 'application/xml',\r\n        'xpm' : 'image/x-xpixmap',\r\n        'xsl' : 'application/xml',\r\n        'xwd' : 'image/x-xwindowdump',\r\n        'zip' : 'application/zip'\r\n    }\r\n\r\nfunction last(arr) {\r\n    var l = arr.length;\r\n    return arr[l - 1];\r\n}\r\n\r\nfunction getMIME(name) {\r\n    return mimeTypes[getFileExtension(name)] || '';\r\n}\r\n\r\nfunction getFileExtension(name) {\r\n    return last(name.split('.'));\r\n}\r\n\r\nfunction getUrl (blob, name) {\r\n    return URL.createObjectURL(blob);\r\n}\r\n\r\nmodule.exports = {\r\n  getMIME : getMIME,\r\n  getFileExtension : getFileExtension,\r\n  getUrl : getUrl\r\n};","{EventEmitter} = require 'events'\r\n\r\nmenuHTML = '''\r\n    <div class=\"mmis_selection_box\">\r\n        <form>\r\n            <fieldset>\r\n                <legend>尺寸</legend>\r\n                <input id=\"size_mini\" type=\"radio\" name =\"size\" value =\"mini\" checked>\r\n                <label for=\"size_mini\">縮圖</label>\r\n                <input id=\"size_full\" type=\"radio\" name =\"size\" value =\"full\">\r\n                <label for=\"size_full\">全圖</label>\r\n            </fieldset>\r\n            <fieldset>\r\n                <legend>格式</legend>\r\n                <input id=\"type_frame\" type=\"radio\" name =\"type\" value =\"frame\" checked>\r\n                <label for=\"type_frame\">單格</label>\r\n                <input id=\"type_gif\" type=\"radio\" name =\"type\" value =\"gif\">\r\n                <label for=\"type_gif\">gif</label>\r\n            </fieldset>\r\n            <fieldset>\r\n                <legend>動作</legend>\r\n                <input id=\"action_download\" type=\"radio\" name =\"action\" value =\"download\" checked>\r\n                <label for=\"action_download\">下載</label>\r\n                <input id=\"action_view\" type=\"radio\" name =\"action\" value =\"view\">\r\n                <label for=\"action_view\">瀏覽</label>\r\n            </fieldset>\r\n        </form>\r\n        <div class=\"botton_wrap\">\r\n            <button data-action=\"run\">\r\n                執行\r\n            </button>\r\n            <button data-action=\"cancel\">\r\n                取消\r\n            </button>\r\n        </div>\r\n    </div>\r\n'''\r\nmenuCss = '''\r\n  .mmis_selection_box {\r\n    display :none;\r\n    z-index: 99999;\r\n    width: 200px;\r\n    height: 280px;\r\n    border: 5px solid #eeeeee;\r\n    border-radius: 10px;\r\n    background: white;\r\n    position: fixed;\r\n    text-align: center;\r\n    left: 50%;\r\n    top: 50%;\r\n    font-size: 18px;\r\n    margin: -145px 0px 0px -105px;\r\n    line-height: 25px;\r\n  }\r\n  .mmis_selection_box fieldset,\r\n  .mmis_selection_box input,\r\n  .mmis_selection_box buttom,\r\n  .mmis_selection_box div {\r\n    margin: 0px;\r\n    border: 0px;\r\n    padding: 0px;\r\n  }\r\n  .mmis_selection_box fieldset {\r\n    margin: 0.5em;\r\n    padding: 0.5em;\r\n    border: 1px solid #dddddd;\r\n    border-radius: 10px;\r\n  }\r\n  .mmis_selection_box fieldset label {\r\n    display: inline-block;\r\n    width: 3em;\r\n    cursor: pointer;\r\n  }\r\n  .mmis_selection_box .botton_wrap {\r\n    margin: 0.5em;\r\n  }\r\n  .mmis_selection_box .botton_wrap button {\r\n    display: block;\r\n    width: 50%;\r\n    text-align: center;\r\n    float: left;\r\n  }\r\n'''\r\nclass menu extends EventEmitter\r\n  constructor: ->\r\n    @$ = null\r\n    @inited = false\r\n  hook: (jQuery)->\r\n    if @inited\r\n      return false\r\n    @$ = jQuery\r\n    @inited = true\r\n    (@$ 'head').append (($ '<style>').text menuCss)\r\n    @menu = $ menuHTML\r\n    (@$ 'body').append @menu\r\n    \r\n    @menu.on 'click', 'button[data-action=\"cancel\"]',(e)=>\r\n      @hide()\r\n      return true\r\n    @menu.on 'click', 'button[data-action=\"run\"]',(e)=>\r\n      @hide()\r\n      data = \r\n        size : (@menu.find 'input[name=\"size\"]:checked').val()\r\n        type : (@menu.find 'input[name=\"type\"]:checked').val()\r\n        action : (@menu.find 'input[name=\"action\"]:checked').val()\r\n      @emit 'run', data\r\n      return true\r\n    return true\r\n  show: ()->\r\n    if not @inited\r\n      return false\r\n    @menu.fadeIn()\r\n    return true\r\n  hide: ()->\r\n    if not @inited\r\n      return false\r\n    @menu.fadeOut()\r\n    return true\r\n\r\nmodule.exports = new menu","if (!process.EventEmitter) process.EventEmitter = function () {};\n\nvar EventEmitter = exports.EventEmitter = process.EventEmitter;\nvar isArray = typeof Array.isArray === 'function'\n    ? Array.isArray\n    : function (xs) {\n        return Object.prototype.toString.call(xs) === '[object Array]'\n    }\n;\n\n// By default EventEmitters will print a warning if more than\n// 10 listeners are added to it. This is a useful default which\n// helps finding memory leaks.\n//\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nvar defaultMaxListeners = 10;\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!this._events) this._events = {};\n  this._events.maxListeners = n;\n};\n\n\nEventEmitter.prototype.emit = function(type) {\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events || !this._events.error ||\n        (isArray(this._events.error) && !this._events.error.length))\n    {\n      if (arguments[1] instanceof Error) {\n        throw arguments[1]; // Unhandled 'error' event\n      } else {\n        throw new Error(\"Uncaught, unspecified 'error' event.\");\n      }\n      return false;\n    }\n  }\n\n  if (!this._events) return false;\n  var handler = this._events[type];\n  if (!handler) return false;\n\n  if (typeof handler == 'function') {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        var args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n    return true;\n\n  } else if (isArray(handler)) {\n    var args = Array.prototype.slice.call(arguments, 1);\n\n    var listeners = handler.slice();\n    for (var i = 0, l = listeners.length; i < l; i++) {\n      listeners[i].apply(this, args);\n    }\n    return true;\n\n  } else {\n    return false;\n  }\n};\n\n// EventEmitter is defined in src/node_events.cc\n// EventEmitter.prototype.emit() is also defined there.\nEventEmitter.prototype.addListener = function(type, listener) {\n  if ('function' !== typeof listener) {\n    throw new Error('addListener only takes instances of Function');\n  }\n\n  if (!this._events) this._events = {};\n\n  // To avoid recursion in the case that type == \"newListeners\"! Before\n  // adding it to the listeners, first emit \"newListeners\".\n  this.emit('newListener', type, listener);\n\n  if (!this._events[type]) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  } else if (isArray(this._events[type])) {\n\n    // Check for listener leak\n    if (!this._events[type].warned) {\n      var m;\n      if (this._events.maxListeners !== undefined) {\n        m = this._events.maxListeners;\n      } else {\n        m = defaultMaxListeners;\n      }\n\n      if (m && m > 0 && this._events[type].length > m) {\n        this._events[type].warned = true;\n        console.error('(node) warning: possible EventEmitter memory ' +\n                      'leak detected. %d listeners added. ' +\n                      'Use emitter.setMaxListeners() to increase limit.',\n                      this._events[type].length);\n        console.trace();\n      }\n    }\n\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  } else {\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  var self = this;\n  self.on(type, function g() {\n    self.removeListener(type, g);\n    listener.apply(this, arguments);\n  });\n\n  return this;\n};\n\nEventEmitter.prototype.removeListener = function(type, listener) {\n  if ('function' !== typeof listener) {\n    throw new Error('removeListener only takes instances of Function');\n  }\n\n  // does not use listeners(), so no side effect of creating _events[type]\n  if (!this._events || !this._events[type]) return this;\n\n  var list = this._events[type];\n\n  if (isArray(list)) {\n    var i = list.indexOf(listener);\n    if (i < 0) return this;\n    list.splice(i, 1);\n    if (list.length == 0)\n      delete this._events[type];\n  } else if (this._events[type] === listener) {\n    delete this._events[type];\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  // does not use listeners(), so no side effect of creating _events[type]\n  if (type && this._events && this._events[type]) this._events[type] = null;\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  if (!this._events) this._events = {};\n  if (!this._events[type]) this._events[type] = [];\n  if (!isArray(this._events[type])) {\n    this._events[type] = [this._events[type]];\n  }\n  return this._events[type];\n};\n","\r\nvar loadPlugin = function($){\r\n    var defaultOption = {\r\n        stat : 'on'\r\n    };\r\n    function off(el) {\r\n        el = $(el);\r\n        el.find('.modal').slideUp(500,function(){\r\n            el.fadeOut(200);\r\n        });\r\n    }\r\n    function on(el) {\r\n        el = $(el);\r\n        el.find('.modal').hide();\r\n        el.fadeIn(200,function(){\r\n            el.find('.modal').slideDown(500);\r\n        });\r\n    }\r\n    $.fn.modal = function modal(option) {\r\n        option = option || {};\r\n        $.extend(option, defaultOption);\r\n        var _modal = $(this);\r\n        if (!_modal.is('.inited')) {\r\n            _modal.on('click', function(e){\r\n                if ($(e.target).is('.mmis1000-modal .exit')) {\r\n                    off(_modal);\r\n                }\r\n                if ($(e.target).is('.mmis1000-modal')) {\r\n                    off(_modal);\r\n                }\r\n            });\r\n            _modal.addClass('inited');\r\n        }\r\n        switch (option.stat) {\r\n            case \"on\":\r\n                on(_modal);\r\n                break;\r\n            case \"off\":\r\n                off(_modal);\r\n                break;\r\n            default:\r\n                on(_modal);\r\n        }\r\n    };\r\n};\r\n\r\nvar modal_css = \".mmis1000-modal{background:rgba(128,128,128,0.5);bottom:0;display:none;left:0;overflow:hidden;position:fixed;right:0;top:0;z-index:99999}\"+\r\n    \".mmis1000-modal .modal{background:#fff;border-radius:10px;bottom:25px;left:25px;position:absolute;right:25px;top:25px}\"+\r\n    \".mmis1000-modal .modal .head{border-bottom-color:#ddd;border-bottom-style:solid;border-bottom-width:2px;height:30px;left:0;padding-left:5px;position:absolute;right:0;top:0}\"+\r\n    \".mmis1000-modal .modal .head .text{color:#666;font-size:20px;line-height:30px}\"+\r\n    \".mmis1000-modal .modal .head .exit{background:red;border-radius:4px;color:#fff;cursor:pointer;font-size:20px;height:20px;line-height:20px;position:absolute;right:5px;text-align:center;top:5px;width:20px}\"+\r\n    \".mmis1000-modal .modal .content-wrapper{bottom:10px;left:0;overflow:auto;position:absolute;right:0;top:32px}\"+\r\n    \".mmis1000-modal .modal .content-wrapper .content{font-size:18px;left:10px;position:absolute;right:10px;text-align:center;top:10px}\"+\r\n    \".mmis1000-modal .modal .content-wrapper .content img{max-width:100%}\";\r\n\r\nvar modalContent = [\r\n    \"<div id='test' class='mmis1000-modal'>\",\r\n    \"<div class='modal'>\",\r\n    \"<div class='head'>\",\r\n    \"<span class='text'>檢視</span>\",\r\n    \"<div class='exit'>\",\r\n    \"X\",\r\n    \"</div>\",\r\n    \"</div>\",\r\n    \"<div class='content-wrapper'>\",\r\n    \"<div class='content'>\",\r\n    \"</div>\",\r\n    \"</div>\",\r\n    \"</div>\",\r\n    \"</div>\"\r\n].join('');\r\n\r\nvar modal = {\r\n  hook : function($) {\r\n    if (this.$) {return;}\r\n    this.$ = $;\r\n    loadPlugin($);\r\n    $('head').append($('<style></style>').html(modal_css));\r\n    this.modal = $(modalContent);\r\n    this.modalContent = this.modal.find('.content')\r\n    $('body').append(this.modal);\r\n  },\r\n  show : function() {\r\n    this.$(this.modal).modal();\r\n  },\r\n  hide : function() {\r\n    this.$(this.modal).modal({stat : off});\r\n  },\r\n  clear : function() {\r\n    /*ensure all element on it destructed correctly*/\r\n    this.modalContent.find('*').remove();\r\n    this.modalContent.text('');\r\n  }\r\n}\r\n\r\nmodule.exports = modal;"]}