{"version":3,"sources":["/pixiv_helper.coffee","/util.js","/modal.js","events"],"names":["Deferer","Downloader","EventEmitter","Gifcreater","GifFrames","imageCreater","lib","main","Modal","Util","require","jQuery","JSZip","GIF","GIF_worker_URL","saveAs","counted","blobs","file","imgURL","imgElement","document","delay","gifFrames","size","frame","p","blob","url","XMLHttpRequest","e","global","$","util","downloader","getTitle","downloadPicture","title","Error","console","GM_registerMenuCommand","unsafeWindow","mimeTypes","getMIME","name","getFileExtension","last","split","getUrl","URL","createObjectURL","module","exports","loadPlugin","defaultOption","stat","off","el","find","slideUp","fadeOut","on","hide","fadeIn","slideDown","fn","modal","option","extend","_modal","is","target","addClass","modal_css","modalContent","join","hook","append","html","show","clear","remove","text","process","isArray","Array","xs","Object","prototype","toString","call","defaultMaxListeners","setMaxListeners","n","_events","maxListeners","emit","type","error","length","arguments","handler","args","slice","apply","listeners","i","l","addListener","listener","warned","m","undefined","trace","push","once","self","g","removeListener","list","indexOf","splice","removeAllListeners"],"mappings":"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","sourceRoot":"..\\src","sourcesContent":["{EventEmitter} = require 'events'\nModal = require 'modal.js'\nUtil = require 'util.js'\n\nlib = \n  $ : jQuery\n  JSZip : JSZip\n  GIF : GIF\n  GIF_worker_URL : GIF_worker_URL\n  saveAs : saveAs\n\nclass Deferer extends EventEmitter\n  constructor: ->\n    @count = 0\n    @counted = 0\n  add: ->\n    @count++\n  count: ->\n    @counted++\n    @emit 'progress', \n      all : @count\n      fired : @ counted\n    if @counted is @count\n      @emit 'done'\n###\n  blobs =\n    blob : blob1,\n    blob : blob2\n###\nclass imageCreater extends EventEmitter\n  constructor : (@Deferer = Deferer, @$ = lib.$) ->\n    @locked = false\n  create : (blobs) ->\n    if @locked is true\n      return false\n    @locked = true\n    @deferer = new @Deferer\n    for file in blobs\n      imgURL = Util.getUrl(file.blob)\n      imgElement =  document.createElement \"img\"\n      imgElement.src = imgURL\n      file.image = imgElement\n      @deferer.add()\n      (@$ imgElement).on 'load', =>\n        @deferer.count()\n        return true\n      \n    @deferer.on 'done', =>\n      @emit 'done', blobs\n      @deferer.removeAllListeners 'done'\n      @deferer = null\n      @removeAllListeners 'done'\n      return true\n    return true\nclass GifFrames\n  constructor : (@frames = []) ->\n  add : (imgElement, delay) ->\n    @frames.push\n      image : imgElement\n      delay : delay\n    return true\n\n###\n  gifFrames =\n    image : image1\n    delay : delay1,\n    image : image2\n    delay : delay2,\n###\nclass Gifcreater extends EventEmitter\n  constructor: (@Gif = lib.GIF, @Gif_worker_path = lib.GIF_worker_URL) ->\n    @locked = false \n  render: (gifFrames) ->\n    if @locked is true\n      return false\n    @locked = true\n    @deferer.removeAllListeners 'done'\n    @deferer = null\n    @gif = new @Gif\n      workers : 2\n      quality : 10\n      workerScript : @Gif_worker_path\n      width : size[0]\n      height : size[1]\n    for frame in gifFrames\n      @gif.addFrame frame.image,\n        delay: frame.delay\n    @gif.on 'progress', (p)=>\n      @emit 'progress', p\n    @gif.on 'finished', (blob)=>\n      @emit 'finished', blob\n      # prevent memory leak\n      try @gif.removeAllListeners 'finished'\n      try @gif.removeAllListeners 'progress'\n      try @removeAllListeners 'finished'\n      try @gremoveAllListeners 'progress'\n      @gif = null\n      @locked = false\n    return true\n\nclass Downloader extends EventEmitter\n  constructor: ()->\n    @_cachedURL = []\n    @_cache = {}\n    @locked = false\n  download: (url)->\n    if @locked\n      return false\n    \n    if url in @_cachedURL\n      @emit 'success', @_cache[url]\n      @removeAllListeners 'success'\n      return true\n    \n    @locked = true\n    \n    @req = new XMLHttpRequest()\n    @req.open \"GET\", url, true\n    @req.responseType = \"blob\"\n    @req.onload = (e)=>\n      blob = @req.response\n      if blob?\n        @_cachedURL.push url\n        @_cache[url] = blob\n        @emit 'success', blob\n        @removeAllListeners 'success'\n      else\n        @emit 'fail', url\n      @locked = false\n      return true\n    @req.send null\n    return true\n\nmain = (global, $, util, saveAs)->\n  downloader = new Downloader\n  getTitle = ()->\n    return global.pixiv.context.illustTitle\n  downloadPicture = (size)->\n    title = getTitle()\n    switch size\n      when 'small'\n        url = global.pixiv.context.ugokuIllustData.src\n      when 'full'\n        url = global.pixiv.context.ugokuIllustFullscreenData.src\n      else\n        throw new Error 'unknown size'\n    downloader.on 'success', (blob)->\n      console.log blob\n      saveAs blob, title\n    console.log downloader.download url\n        \n  GM_registerMenuCommand '下載檔案!(縮圖)', ->\n    downloadPicture 'small'\n  GM_registerMenuCommand '下載檔案!(全圖)', ->\n    downloadPicture 'full'\n\nmain unsafeWindow, lib.$, Util, lib.saveAs","\r\nvar mimeTypes =\r\n    {\r\n        'a' : 'application/octet-stream',\r\n        'ai' : 'application/postscript',\r\n        'aif' : 'audio/x-aiff',\r\n        'aifc' : 'audio/x-aiff',\r\n        'aiff' : 'audio/x-aiff',\r\n        'au' : 'audio/basic',\r\n        'avi' : 'video/x-msvideo',\r\n        'bat' : 'text/plain',\r\n        'bin' : 'application/octet-stream',\r\n        'bmp' : 'image/x-ms-bmp',\r\n        'c' : 'text/plain',\r\n        'cdf' : 'application/x-cdf',\r\n        'csh' : 'application/x-csh',\r\n        'css' : 'text/css',\r\n        'dll' : 'application/octet-stream',\r\n        'doc' : 'application/msword',\r\n        'dot' : 'application/msword',\r\n        'dvi' : 'application/x-dvi',\r\n        'eml' : 'message/rfc822',\r\n        'eps' : 'application/postscript',\r\n        'etx' : 'text/x-setext',\r\n        'exe' : 'application/octet-stream',\r\n        'gif' : 'image/gif',\r\n        'gtar' : 'application/x-gtar',\r\n        'h' : 'text/plain',\r\n        'hdf' : 'application/x-hdf',\r\n        'htm' : 'text/html',\r\n        'html' : 'text/html',\r\n        'jpe' : 'image/jpeg',\r\n        'jpeg' : 'image/jpeg',\r\n        'jpg' : 'image/jpeg',\r\n        'js' : 'application/x-javascript',\r\n        'ksh' : 'text/plain',\r\n        'latex' : 'application/x-latex',\r\n        'm1v' : 'video/mpeg',\r\n        'man' : 'application/x-troff-man',\r\n        'me' : 'application/x-troff-me',\r\n        'mht' : 'message/rfc822',\r\n        'mhtml' : 'message/rfc822',\r\n        'mif' : 'application/x-mif',\r\n        'mov' : 'video/quicktime',\r\n        'movie' : 'video/x-sgi-movie',\r\n        'mp2' : 'audio/mpeg',\r\n        'mp3' : 'audio/mpeg',\r\n        'mp4' : 'video/mp4',\r\n        'mpa' : 'video/mpeg',\r\n        'mpe' : 'video/mpeg',\r\n        'mpeg' : 'video/mpeg',\r\n        'mpg' : 'video/mpeg',\r\n        'ms' : 'application/x-troff-ms',\r\n        'nc' : 'application/x-netcdf',\r\n        'nws' : 'message/rfc822',\r\n        'o' : 'application/octet-stream',\r\n        'obj' : 'application/octet-stream',\r\n        'oda' : 'application/oda',\r\n        'pbm' : 'image/x-portable-bitmap',\r\n        'pdf' : 'application/pdf',\r\n        'pfx' : 'application/x-pkcs12',\r\n        'pgm' : 'image/x-portable-graymap',\r\n        'png' : 'image/png',\r\n        'pnm' : 'image/x-portable-anymap',\r\n        'pot' : 'application/vnd.ms-powerpoint',\r\n        'ppa' : 'application/vnd.ms-powerpoint',\r\n        'ppm' : 'image/x-portable-pixmap',\r\n        'pps' : 'application/vnd.ms-powerpoint',\r\n        'ppt' : 'application/vnd.ms-powerpoint',\r\n        'pptx' : 'application/vnd.ms-powerpoint',\r\n        'ps' : 'application/postscript',\r\n        'pwz' : 'application/vnd.ms-powerpoint',\r\n        'py' : 'text/x-python',\r\n        'pyc' : 'application/x-python-code',\r\n        'pyo' : 'application/x-python-code',\r\n        'qt' : 'video/quicktime',\r\n        'ra' : 'audio/x-pn-realaudio',\r\n        'ram' : 'application/x-pn-realaudio',\r\n        'ras' : 'image/x-cmu-raster',\r\n        'rdf' : 'application/xml',\r\n        'rgb' : 'image/x-rgb',\r\n        'roff' : 'application/x-troff',\r\n        'rtx' : 'text/richtext',\r\n        'sgm' : 'text/x-sgml',\r\n        'sgml' : 'text/x-sgml',\r\n        'sh' : 'application/x-sh',\r\n        'shar' : 'application/x-shar',\r\n        'snd' : 'audio/basic',\r\n        'so' : 'application/octet-stream',\r\n        'src' : 'application/x-wais-source',\r\n        'swf' : 'application/x-shockwave-flash',\r\n        't' : 'application/x-troff',\r\n        'tar' : 'application/x-tar',\r\n        'tcl' : 'application/x-tcl',\r\n        'tex' : 'application/x-tex',\r\n        'texi' : 'application/x-texinfo',\r\n        'texinfo': 'application/x-texinfo',\r\n        'tif' : 'image/tiff',\r\n        'tiff' : 'image/tiff',\r\n        'tr' : 'application/x-troff',\r\n        'tsv' : 'text/tab-separated-values',\r\n        'txt' : 'text/plain',\r\n        'ustar' : 'application/x-ustar',\r\n        'vcf' : 'text/x-vcard',\r\n        'wav' : 'audio/x-wav',\r\n        'wiz' : 'application/msword',\r\n        'wsdl' : 'application/xml',\r\n        'xbm' : 'image/x-xbitmap',\r\n        'xlb' : 'application/vnd.ms-excel',\r\n        'xls' : 'application/vnd.ms-excel',\r\n        'xlsx' : 'application/vnd.ms-excel',\r\n        'xml' : 'text/xml',\r\n        'xpdl' : 'application/xml',\r\n        'xpm' : 'image/x-xpixmap',\r\n        'xsl' : 'application/xml',\r\n        'xwd' : 'image/x-xwindowdump',\r\n        'zip' : 'application/zip'\r\n    }\r\n\r\nfunction getMIME(name) {\r\n    return mimeTypes[getFileExtension(name)] || '';\r\n}\r\n\r\nfunction getFileExtension(name) {\r\n    return last(name.split('.'));\r\n}\r\n\r\nfunction getUrl (blob, name) {\r\n    return URL.createObjectURL(blob);\r\n}\r\n\r\nmodule.exports = {\r\n  getMIME : getMIME,\r\n  getFileExtension : getFileExtension,\r\n  getUrl : getUrl\r\n};","\r\nvar loadPlugin = function($){\r\n    var defaultOption = {\r\n        stat : 'on'\r\n    };\r\n    function off(el) {\r\n        el = $(el);\r\n        el.find('.modal').slideUp(500,function(){\r\n            el.fadeOut(200);\r\n        });\r\n    }\r\n    function on(el) {\r\n        el = $(el);\r\n        el.find('.modal').hide();\r\n        el.fadeIn(200,function(){\r\n            el.find('.modal').slideDown(500);\r\n        });\r\n    }\r\n    $.fn.modal = function modal(option) {\r\n        option = option || {};\r\n        $.extend(option, defaultOption);\r\n        var _modal = $(this);\r\n        if (!_modal.is('.inited')) {\r\n            _modal.on('click', function(e){\r\n                if ($(e.target).is('.mmis1000-modal .exit')) {\r\n                    off(_modal);\r\n                }\r\n                if ($(e.target).is('.mmis1000-modal')) {\r\n                    off(_modal);\r\n                }\r\n            });\r\n            _modal.addClass('inited');\r\n        }\r\n        switch (option.stat) {\r\n            case \"on\":\r\n                on(_modal);\r\n                break;\r\n            case \"off\":\r\n                off(_modal);\r\n                break;\r\n            default:\r\n                on(_modal);\r\n        }\r\n    };\r\n};\r\n\r\nvar modal_css = \".mmis1000-modal{background:rgba(128,128,128,0.5);bottom:0;display:none;left:0;overflow:hidden;position:fixed;right:0;top:0;z-index:99999}\"+\r\n    \".mmis1000-modal .modal{background:#fff;border-radius:10px;bottom:25px;left:25px;position:absolute;right:25px;top:25px}\"+\r\n    \".mmis1000-modal .modal .head{border-bottom-color:#ddd;border-bottom-style:solid;border-bottom-width:2px;height:30px;left:0;padding-left:5px;position:absolute;right:0;top:0}\"+\r\n    \".mmis1000-modal .modal .head .text{color:#666;font-size:20px;line-height:30px}\"+\r\n    \".mmis1000-modal .modal .head .exit{background:red;border-radius:4px;color:#fff;cursor:pointer;font-size:20px;height:20px;line-height:20px;position:absolute;right:5px;text-align:center;top:5px;width:20px}\"+\r\n    \".mmis1000-modal .modal .content-wrapper{bottom:10px;left:0;overflow:auto;position:absolute;right:0;top:32px}\"+\r\n    \".mmis1000-modal .modal .content-wrapper .content{font-size:18px;left:10px;position:absolute;right:10px;text-align:center;top:10px}\"+\r\n    \".mmis1000-modal .modal .content-wrapper .content img{max-width:100%}\";\r\n\r\nvar modalContent = [\r\n    \"<div id='test' class='mmis1000-modal'>\",\r\n    \"<div class='modal'>\",\r\n    \"<div class='head'>\",\r\n    \"<span class='text'>�j���˵�</span>\",\r\n    \"<div class='exit'>\",\r\n    \"X\",\r\n    \"</div>\",\r\n    \"</div>\",\r\n    \"<div class='content-wrapper'>\",\r\n    \"<div class='content'>\",\r\n    \"</div>\",\r\n    \"</div>\",\r\n    \"</div>\",\r\n    \"</div>\"\r\n].join('');\r\n\r\nvar modal = {\r\n  hook : function($) {\r\n    if (this.$) {return;}\r\n    this.$ = $;\r\n    loadPlugin($);\r\n    $('head').append($('<style></style>').html(modal_css));\r\n    this.modal = $(modalContent);\r\n    this.modalContent = this.modal.find('.content')\r\n    $('body').append(this.modal);\r\n  },\r\n  show : function() {\r\n    this.$(this.modal).modal();\r\n  },\r\n  hide : function() {\r\n    this.$(this.modal).modal({stat : off});\r\n  },\r\n  clear : function() {\r\n    /*ensure all element on it destructed correctly*/\r\n    this.modalContent.find('*').remove();\r\n    this.modalContent.text('');\r\n  }\r\n}\r\n\r\nmodule.exports = modal;","if (!process.EventEmitter) process.EventEmitter = function () {};\n\nvar EventEmitter = exports.EventEmitter = process.EventEmitter;\nvar isArray = typeof Array.isArray === 'function'\n    ? Array.isArray\n    : function (xs) {\n        return Object.prototype.toString.call(xs) === '[object Array]'\n    }\n;\n\n// By default EventEmitters will print a warning if more than\n// 10 listeners are added to it. This is a useful default which\n// helps finding memory leaks.\n//\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nvar defaultMaxListeners = 10;\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!this._events) this._events = {};\n  this._events.maxListeners = n;\n};\n\n\nEventEmitter.prototype.emit = function(type) {\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events || !this._events.error ||\n        (isArray(this._events.error) && !this._events.error.length))\n    {\n      if (arguments[1] instanceof Error) {\n        throw arguments[1]; // Unhandled 'error' event\n      } else {\n        throw new Error(\"Uncaught, unspecified 'error' event.\");\n      }\n      return false;\n    }\n  }\n\n  if (!this._events) return false;\n  var handler = this._events[type];\n  if (!handler) return false;\n\n  if (typeof handler == 'function') {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        var args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n    return true;\n\n  } else if (isArray(handler)) {\n    var args = Array.prototype.slice.call(arguments, 1);\n\n    var listeners = handler.slice();\n    for (var i = 0, l = listeners.length; i < l; i++) {\n      listeners[i].apply(this, args);\n    }\n    return true;\n\n  } else {\n    return false;\n  }\n};\n\n// EventEmitter is defined in src/node_events.cc\n// EventEmitter.prototype.emit() is also defined there.\nEventEmitter.prototype.addListener = function(type, listener) {\n  if ('function' !== typeof listener) {\n    throw new Error('addListener only takes instances of Function');\n  }\n\n  if (!this._events) this._events = {};\n\n  // To avoid recursion in the case that type == \"newListeners\"! Before\n  // adding it to the listeners, first emit \"newListeners\".\n  this.emit('newListener', type, listener);\n\n  if (!this._events[type]) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  } else if (isArray(this._events[type])) {\n\n    // Check for listener leak\n    if (!this._events[type].warned) {\n      var m;\n      if (this._events.maxListeners !== undefined) {\n        m = this._events.maxListeners;\n      } else {\n        m = defaultMaxListeners;\n      }\n\n      if (m && m > 0 && this._events[type].length > m) {\n        this._events[type].warned = true;\n        console.error('(node) warning: possible EventEmitter memory ' +\n                      'leak detected. %d listeners added. ' +\n                      'Use emitter.setMaxListeners() to increase limit.',\n                      this._events[type].length);\n        console.trace();\n      }\n    }\n\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  } else {\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  var self = this;\n  self.on(type, function g() {\n    self.removeListener(type, g);\n    listener.apply(this, arguments);\n  });\n\n  return this;\n};\n\nEventEmitter.prototype.removeListener = function(type, listener) {\n  if ('function' !== typeof listener) {\n    throw new Error('removeListener only takes instances of Function');\n  }\n\n  // does not use listeners(), so no side effect of creating _events[type]\n  if (!this._events || !this._events[type]) return this;\n\n  var list = this._events[type];\n\n  if (isArray(list)) {\n    var i = list.indexOf(listener);\n    if (i < 0) return this;\n    list.splice(i, 1);\n    if (list.length == 0)\n      delete this._events[type];\n  } else if (this._events[type] === listener) {\n    delete this._events[type];\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  // does not use listeners(), so no side effect of creating _events[type]\n  if (type && this._events && this._events[type]) this._events[type] = null;\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  if (!this._events) this._events = {};\n  if (!this._events[type]) this._events[type] = [];\n  if (!isArray(this._events[type])) {\n    this._events[type] = [this._events[type]];\n  }\n  return this._events[type];\n};\n"]}